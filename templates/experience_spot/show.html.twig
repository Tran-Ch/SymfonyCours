{# templates/experience_spot/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ spot.title }}{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <style>
    .spot-header-card {
      box-shadow: 0 3px 8px rgba(0,0,0,0.15);
      border-radius: 14px;
      overflow: hidden;
      background-color: #d7e48e;
    }
    .spot-header-image {
      width: 100%;
      max-height: 320px;
      object-fit: cover;
    }
    .spot-header-body {
      padding: 16px 20px;
    }
  </style>
{% endblock %}

{% block body %}
<div class="container mt-4">

  {# Card header: ảnh + nút like #}
  <div class="spot-header-card mb-4">
    <img src="{{ asset('Image/nord/' ~ spot.imageFilename) }}"
         alt="{{ spot.title }}"
         class="spot-header-image">

    <div class="spot-header-body d-flex justify-content-between align-items-center">
      <div>
        <h3 class="mb-1">{{ spot.title }}</h3>
        <small class="text-muted">
          Région : {{ spot.region|capitalize }} – Catégorie : {{ spot.category|capitalize }}
        </small>
      </div>

      <form method="post" action="{{ path('app_experience_spot_like', {slug: spot.slug}) }}">
        <button class="btn btn-sm {{ spot.isLikedByUser(app.user) ? 'btn-success' : 'btn-outline-success' }}">
          ❤ {{ spot.likesCount }}
          {{ spot.isLikedByUser(app.user) ? 'Je n’aime plus' : 'J’aime' }}
        </button>
      </form>
    </div>

    <div class="px-4 pb-3">
      <p class="mb-0">{{ spot.shortDescription|nl2br }}</p>
    </div>
  </div>

  {# COMMENTAIRES #}
  <h5 class="mb-3">Commentaires ({{ spot.comments|length }})</h5>

  {% if spot.comments is not empty %}
    <div class="list-group mb-4">
      {% for comment in spot.comments %}
        <div class="list-group-item">
          <div class="d-flex justify-content-between">
            <strong>{{ comment.utilisateur.prenom ?? comment.utilisateur.email ?? 'Utilisateur' }}</strong>
            <small class="text-muted">{{ comment.date|date('d/m/Y H:i') }}</small>
          </div>
          <p class="mb-0 mt-2">{{ comment.text|nl2br }}</p>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted mb-4">Aucun commentaire pour l’instant.</p>
  {% endif %}

  {# FORM COMMENT #}
  <div class="card mb-5">
    <div class="card-header">Laisser un commentaire</div>
    <div class="card-body">
      {% if app.user %}
        {{ form_start(commentForm) }}
          {{ form_widget(commentForm) }}
          <div class="mt-3 text-end">
            <button type="submit" class="btn btn-primary">Publier</button>
          </div>
        {{ form_end(commentForm) }}
      {% else %}
        <p class="text-muted">
          Vous devez être connecté pour commenter.
          <a href="{{ path('app_login') }}">Se connecter</a>
        </p>
      {% endif %}
    </div>
  </div>

  <a href="{{ path('app_nord_incroyable') }}" class="btn btn-outline-secondary">
    ← Retour à la liste
  </a>
</div>
{% endblock %}
